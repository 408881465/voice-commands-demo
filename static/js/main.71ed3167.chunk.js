(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(t,e,n){t.exports=n(26)},17:function(t,e,n){},20:function(t,e,n){},26:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r),a=n(6),s=n.n(a),c=(n(17),n(3)),o=n.n(c),l=n(7),u=n(1),f=n(2),h=n(10),d=n(8),g=n(11),m=(n(20),n(9)),p=n.n(m),w=function(){function t(){Object(u.a)(this,t)}return Object(f.a)(t,null,[{key:"getTimestamp",value:function(){return window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}},{key:"writeUTFBytes",value:function(t,e,n){for(var r=n.length,i=0;i<r;i++)t.setUint8(e+i,n.charCodeAt(i))}},{key:"mergeBuffers",value:function(t){if(0!==t.length){for(var e=new Float32Array(t.length*t[0].length),n=0,r=t.length,i=0;i<r;i++){var a=t[i];e.set(a,n),n+=a.length}return e}}},{key:"bufferToBlob",value:function(t,e){var n=this.mergeBuffers(t,e);if(n){var r=new ArrayBuffer(44+2*n.length),i=new DataView(r);this.writeUTFBytes(i,0,"RIFF"),i.setUint32(4,44+2*n.length-8,!0),this.writeUTFBytes(i,8,"WAVE"),this.writeUTFBytes(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,48e3,!0),i.setUint32(28,96e3,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),this.writeUTFBytes(i,36,"data"),i.setUint32(40,2*n.length,!0);for(var a=n.length,s=44,c=0;c<a;c++)i.setInt16(s,32767*n[c],!0),s+=2;return new Blob([i],{type:"audio/wav"})}}},{key:"getVoiceFile",value:function(t,e){if(t){var n=document.createElement("a");n.target="_blank",n.innerHTML="Open Recorded Audio",n.href=URL.createObjectURL(t),p()("#audios-container").html(n)}}}]),t}(),y=n(21),v=n(22),b=function(){function t(){Object(u.a)(this,t)}return Object(f.a)(t,null,[{key:"train",value:function(t,e,n){return n("training"),this.buffer=t,y.bufferSize=this.bufferSize,this.bufferMfcc=this.createMfccMetric(),this.mfccHistoryArr.push({mfcc:this.bufferMfcc,transcript:e}),this.mfccHistoryCunters[e]||0===this.mfccHistoryCunters[e]||(this.mfccHistoryCunters[e]=0),this.mfccHistoryCunters[e]++,console.log(this.bufferMfcc),console.log(this.mfccHistoryArr),n("training saved"),!0}},{key:"recognize",value:function(t,e){var n;return this.buffer=t,y.bufferSize=this.bufferSize,this.bufferMfcc=this.createMfccMetric(),console.log(this.bufferMfcc),this.startTime=w.getTimestamp(),e("recognizing"),this.calculateDistanceArr(),console.log(this.mfccDistArr),this.K_factor<=this.mfccHistoryArr.length&&((n=this.getMostSimilarKnn(this.mfccDistArr,this.compareMfcc,this.K_factor))&&(this.mfccHistoryCunters[n.transcript]<this._minNumberOfVariants||n.confidence<this._minKnnConfidence)&&(n=null),n&&""!==n.transcript&&(this.mfccHistoryArr.push({mfcc:this.bufferMfcc,transcript:n.transcript}),this.mfccHistoryCunters[n.transcript]||0===this.mfccHistoryCunters[n.transcript]||(this.mfccHistoryCunters[n.transcript]=0),this.mfccHistoryCunters[n.transcript]++)),!n||n.confidence<.8?(this.endTime=w.getTimestamp(),e("not recognized"),console.log("recognition locally failed or returned no good result ("+(this.endTime-this.startTime)+" ms)"),null):(n.processTime=w.getTimestamp()-this.startTime,e("recognized"),n)}},{key:"calculateDistanceArr",value:function(){this.mfccDistArr=[];for(var t=0;t<this.mfccHistoryArr.length;t++)if(this.isInDictionary(this.mfccHistoryArr[t].transcript)){var e=new v(this.mfccHistoryArr[t].mfcc,this.bufferMfcc,this.EuclideanDistance).getDistance();this.mfccDistArr.push({dist:e,transcript:this.mfccHistoryArr[t].transcript})}}},{key:"isInDictionary",value:function(t){for(var e=0;e<this.dictionary.length;e++)if(this.dictionary[e]===t)return!0;return!1}},{key:"getMostSimilarKnn",value:function(t,e,n){if(t&&0!==t.length&&!(n>t.length)){var r=t,i=e;r.sort(i);for(var a=r.slice(0,n),s=[],c={transcript:"",weight:0,confidence:0},o=0;o<a.length;o++)a[o].dist>this._minDTWDist||(s[a[o].transcript]?s[a[o].transcript].weight=s[a[o].transcript].weight+1e3/a[o].dist:s[a[o].transcript]={weight:1e3/a[o].dist},c.weight<s[a[o].transcript].weight&&(c={transcript:a[o].transcript,weight:s[a[o].transcript].weight}));if(c&&""===c.transcript&&(c=null),c){var l=0,u=0;for(o=0;o<r.length;o++)r[o].transcript===c.transcript&&(l+=r[o].dist,u++);c.confidence=this.getGaussianKernel(l/u).toFixed(4)}return c}}},{key:"getGaussianKernel",value:function(t){return Math.pow(Math.E,-.5*Math.pow(t/1e3,2))}},{key:"createMfccMetric",value:function(){for(var t=[],e=0;e<this._buffArrSize;e++)if(this.buffer[e]&&this.buffer[e].length===this.bufferSize){var n=y.extract("mfcc",this.buffer[e]);t.push(n)}return t}},{key:"EuclideanDistance",value:function(t,e){var n=0;if(t.length!==e.length)return-1;for(var r=0;r<t.length;r++)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)}},{key:"compareMfcc",value:function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0}}]),t}();b.startTime=null,b.endTime=null,b.calibMode=!1,b.mfccHistoryArr=[],b.mfccHistoryCunters=[],b.dictionary=["one","two","three"],b.bufferSize=2048,b._buffArrSize=40,b._minNumberOfVariants=2,b._minKnnConfidence=0,b._minDTWDist=1e3,b.K_factor=3,b.mfccDistArr=[],b.buffer={};var M=n(24),S=function(t){function e(t){var n;return Object(u.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).onMediaSuccess=function(t){n.state.trained||n.setState({currentTrainingIndex:0,msg:"say the next word loud and clear, and wait until we process it.  ===>   "+b.dictionary[0]}),n.audioContextType=window.AudioContext||window.webkitAudioContext,n.localStream=t,n.track=n.localStream.getTracks()[0],n.context=new n.audioContextType;var e=n.context.createMediaStreamSource(n.localStream);n.context.createScriptProcessor?n.node=n.context.createScriptProcessor(b.bufferSize,n.numChannels,n.numChannels):n.node=n.context.createJavaScriptNode(b.bufferSize,n.numChannels,n.numChannels),n.node.onaudioprocess=function(t){var e=t.inputBuffer.getChannelData(0);n.recording&&(n.leftchannel.length<b._buffArrSize?(n.leftchannel.push(new Float32Array(e)),n.recordingLength+=n.bufferSize):(n.leftchannel.splice(0,1),n.leftchannel.push(new Float32Array(e))))},e.connect(n.node),n.node.connect(n.context.destination),n.speechHark=M(n.localStream,{interval:n._harkInterval,threshold:n._threshold,play:!1,recoredInterval:n._stopRecTimeout}),n.speechHark.on("speaking",function(){n.setState({statusMsg:"recoding"}),setTimeout(function(){n.stopRec()},n._stopRecTimeout)}),n.speechHark.on("stopped_speaking",function(){})},n.stopRec=function(){n.setState({statusMsg:"stopped recoding"}),n.recording=!1;var t=n.leftchannel.slice(0),e=n.recordingLength,r=w.bufferToBlob(t,e);if(r){w.getVoiceFile(r,0);var i=new window.FileReader;i.readAsDataURL(r),i.onloadend=function(){if(n.state.trained){var e=b.recognize(t,n.setStateMsgFunc);e?n.setState({msg:"Great! try to Again. the result is ===> "+e.transcript}):n.setState({msg:"Didn't Got it! please try to Again loud and clear."}),console.log(e)}else{var r=b.train(t,b.dictionary[n.state.currentTrainingIndex%b.dictionary.length],n.setStateMsgFunc);n.traingNextWord(r)}},n.leftchannel.length=0,n.recordingLength=0,n.recording=!0}},n.traingNextWord=function(t){if(t){var e=n.state.currentTrainingIndex+1;e>2*b.dictionary.length-1?n.setState({trained:!0,currentTrainingIndex:e,msg:"training is finished, now we will try to guess what you tring to say from the trained vocabulary.",modeMsg:"recognizing mode"}):n.setState({currentTrainingIndex:e,msg:"say the next word loud and clear, and wait until we process it.  ===>  "+b.dictionary[e%b.dictionary.length]})}else n.setState({msg:"we didn't got it, try again, say the next word loud and clear, and wait until we process it.    "+b.dictionary[n.state.currentTrainingIndex%b.dictionary.length]})},n.setStateMsgFunc=function(t){n.setState({statusMsg:t})},n.stopUserMediaTrack=function(){n.track&&n.track.stop()},n.stopListening=function(){n.recording=!1,n.leftchannel&&(n.leftchannel.length=0,n.leftchannel=[]),n.localStream=null,n.recordingLength=0,n.speechHark&&n.speechHark.stop(),n.stopUserMediaTrack&&n.stopUserMediaTrack()},n.start=function(){n.startListening(),n.state.trained?n.setState({modeMsg:"recognizing mode"}):n.setState({modeMsg:"training mode"})},n.stop=function(){n.stopListening(),n.setState({statusMsg:"stoped"})},n.state={msg:"click start",modeMsg:"",statusMsg:"",trained:!1,currentTrainingIndex:null,result:""},n.audioContextType=null,n.localstream=null,n.context=null,n.track=null,n.node=null,n.recording=!0,n.speechHark=null,n.leftchannel=[],n._stopRecTimeout=1e3,n._threshold=-50,n._harkInterval=100,n.recordingLength=0,n.numChannels=1,n}return Object(g.a)(e,t),Object(f.a)(e,[{key:"startListening",value:function(){var t=Object(l.a)(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:e=t.sent,this.onMediaSuccess(e);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement("div",{className:"row"},i.a.createElement("button",{onClick:this.start},"Start"),i.a.createElement("button",{onClick:this.stop},"Stop")),i.a.createElement("div",{className:"msgs"},i.a.createElement("span",null,this.state.modeMsg)),i.a.createElement("div",{className:"msgs"},i.a.createElement("span",null,this.state.msg)),i.a.createElement("div",{className:"msgs"},i.a.createElement("span",null,this.state.statusMsg)),i.a.createElement("div",{id:"audios-container"}))}}]),e}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[12,1,2]]]);
//# sourceMappingURL=main.71ed3167.chunk.js.map